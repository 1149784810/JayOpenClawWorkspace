# Code Optimizer Skill

C# 代码性能优化工具 - 基于模式识别和最佳实践的自动化优化助手。

## 快速开始

### 1. 分析代码

```
请分析 Assets/Scripts/Player.cs 的性能问题
```

### 2. 执行优化

```
优化 Assets/Scripts/Player.cs
```

步骤：
1. 我会生成优化报告
2. **等待你确认** "同意" 或 "执行"
3. 应用优化并添加注释

## 支持的优化模式

### 查找优化
- `List.Find()` → `Dictionary.TryGetValue()`
- `List.Contains()` → `HashSet.Contains()`
- 循环查找 → 直接索引访问

### 缓存优化
- 重复计算 → 懒加载 + 脏标记
- 频繁创建的对象 → 对象池
- 反射调用 → 缓存 MethodInfo

### 循环优化
- 正向遍历删除 → 反向遍历
- 空列表检查 → 快速退出
- 嵌套循环 → 扁平化或缓存长度

### 内存优化
- `new List<>()` → 静态空列表
- 大对象频繁分配 → 对象池
- 字符串拼接 → StringBuilder

### 代码简化
- 单语句方法 → 表达式体
- 复杂条件 → 卫语句提前返回
- 重复代码 → 提取方法

## 示例对话

### 场景 1：分析代码
**用户**: 分析一下这个脚本的性能问题
**我**: [分析代码]
**我**: 发现以下可优化点：
1. GetTrait 使用线性搜索，建议改为字典 (O(n)→O(1))
2. GetAbilities 每次都重建列表，建议加缓存
3. ...
**用户**: 同意优化
**我**: [执行优化，添加注释]

### 场景 2：指定优化
**用户**: 把 Card.cs 里的查找都改成字典
**我**: [定位相关代码]
**我**: 找到 3 处可优化，已生成优化方案：
- Line 45: GetTrait() 
- Line 78: GetStatus()
- Line 112: HasAbility()
**用户**: 执行
**我**: [应用优化]

## 文件结构

```
skills/code-optimizer/
├── SKILL.md           # 能力定义（主文档）
├── README.md          # 使用说明（本文档）
└── docs/
    └── csharp-patterns.md  # 优化模式库
```

## 注意事项

⚠️ **必须先确认**
- 我会展示优化计划
- 等待你说"同意"或"执行"
- 不会自动修改你的代码

⚠️ **保留原文件**
- 优化前可选择备份
- 优化后添加 `// 优化点：XXX` 注释
- 便于追踪修改

## 反馈

如果发现优化问题或有改进建议，请告诉我！

---

*Created: 2026-02-10*
*Based on: XiuXianCards optimization experience*
