---
name: code-optimizer
description: è‡ªåŠ¨åˆ†æ C# ä»£ç å¹¶æä¾›æ€§èƒ½ä¸è´¨é‡ä¼˜åŒ–å»ºè®®
---

# SKILL: code-optimizer

## æè¿°

è‡ªåŠ¨åˆ†æ C# ä»£ç å¹¶æä¾›æ€§èƒ½ä¸è´¨é‡ä¼˜åŒ–å»ºè®®ã€‚ä¸“æ³¨äº Unity æ¸¸æˆå¼€å‘å’Œ .NET åº”ç”¨çš„é«˜æ€§èƒ½ä»£ç æ”¹è¿›ã€‚

## ä½¿ç”¨åœºæ™¯

- Unity æ¸¸æˆå¼€å‘ä»£ç ä¼˜åŒ–
- .NET åº”ç”¨æ€§èƒ½è°ƒä¼˜
- æœåŠ¡ç«¯ä»£ç é‡æ„
- ä»£ç å®¡æŸ¥è¾…åŠ©

## æ ¸å¿ƒèƒ½åŠ›

| ä¼˜åŒ–ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|---------|------|------|
| **æŸ¥æ‰¾æ€§èƒ½** | List çº¿æ€§æœç´¢ â†’ Dictionary å“ˆå¸ŒæŸ¥æ‰¾ | `O(n)` è½¬ `O(1)` |
| **å¾ªç¯ä¼˜åŒ–** | åå‘éå†ã€å¿«é€Ÿé€€å‡ºã€å‡å°‘è¿­ä»£æ¬¡æ•° | `for (i=n-1; i>=0; i--)` |
| **å†…å­˜åˆ†é…** | é™æ€ç©ºåˆ—è¡¨ã€å¯¹è±¡æ± ã€å‡å°‘ GC å‹åŠ› | å¤ç”¨é›†åˆå¯¹è±¡ |
| **ç¼“å­˜ç­–ç•¥** | æ‡’åŠ è½½ã€è„æ ‡è®°ã€é¿å…é‡å¤è®¡ç®— | `bool isDirty` æ¨¡å¼ |
| **ç©ºå€¼æ£€æŸ¥** | é˜²å¾¡æ€§ç¼–ç¨‹ã€æå‰è¿”å› | `if (x == null) return;` |
| **è¡¨è¾¾å¼ç®€åŒ–** | å•è¯­å¥æ–¹æ³•ä½“ã€è¡¨è¾¾å¼ä½“æ–¹æ³• | `=>` ç®€åŒ–è¯­æ³• |

## æ‰§è¡Œæµç¨‹

```
1. è¯»å–ä»£ç æ–‡ä»¶
   â†“
2. è¯­æ³•åˆ†æï¼ˆè¯†åˆ«å¯ä¼˜åŒ–æ¨¡å¼ï¼‰
   â†“
3. åŒ¹é…ä¼˜åŒ–è§„åˆ™
   â†“
4. ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Šï¼ˆé£é™©/æ”¶ç›Šè¯„ä¼°ï¼‰
   â†“
5. ã€ç­‰å¾…ç”¨æˆ·ç¡®è®¤ã€‘
   â†“
6. æ‰§è¡Œä¼˜åŒ– + æ·»åŠ ä¼˜åŒ–æ³¨é‡Š
```

## çº¦æŸæ¡ä»¶

âš ï¸ **é‡è¦è§„åˆ™**

1. **å¿…é¡»è·å¾—ç”¨æˆ·ç¡®è®¤** æ‰èƒ½ä¿®æ”¹ä»»ä½•æ–‡ä»¶
2. **ç”ŸæˆæŠ¥å‘Šåéœ€æ˜ç¡®ç­‰å¾…** ç”¨æˆ·è¯´"åŒæ„/æ‰§è¡Œ"
3. **ç¦æ­¢è‡ªåŠ¨æ‰§è¡Œ** ä»»ä½•æ–‡ä»¶ä¿®æ”¹æ“ä½œ
4. **åªè¯»æ“ä½œ**ï¼ˆåˆ†æã€æŸ¥çœ‹ï¼‰æ— éœ€ç¡®è®¤
5. **ä¼˜åŒ–æ³¨é‡Šæ ¼å¼**: `// ä¼˜åŒ–ç‚¹ï¼šXXX`

## ä½¿ç”¨æ–¹æ³•

### åˆ†ææ¨¡å¼
```
åˆ†æ Card.cs çš„æ€§èƒ½ç“¶é¢ˆ
```

### ä¼˜åŒ–æ¨¡å¼
```
ä¼˜åŒ– Assets/Scripts/Card.cs
```
â†’ ç”ŸæˆæŠ¥å‘Š â†’ ç­‰å¾…ç”¨æˆ·ç¡®è®¤ â†’ æ‰§è¡Œä¼˜åŒ–

## ä¼˜åŒ–ç¤ºä¾‹

### ç¤ºä¾‹ 1: å­—å…¸åŠ é€Ÿ
```csharp
// ä¼˜åŒ–å‰: O(n) çº¿æ€§æœç´¢
public CardTrait GetTrait(string id)
{
    foreach (CardTrait trait in traits)
        if (trait.id == id) return trait;
    return null;
}

// ä¼˜åŒ–å: O(1) å­—å…¸æŸ¥æ‰¾
private Dictionary<string, CardTrait> trait_dict;
public CardTrait GetTrait(string id)
{
    trait_dict.TryGetValue(id, out CardTrait trait);
    return trait;
}
```

### ç¤ºä¾‹ 2: è„æ ‡è®°ç¼“å­˜
```csharp
// ä¼˜åŒ–å‰: æ¯æ¬¡é‡å»ºåˆ—è¡¨
public List<AbilityData> GetAbilities()
{
    var list = new List<AbilityData>();
    foreach (var id in abilities)
        list.Add(AbilityData.Get(id));
    return list;
}

// ä¼˜åŒ–å: è„æ ‡è®°å»¶è¿Ÿé‡å»º
[System.NonSerialized] private bool abilities_dirty = true;
public List<AbilityData> GetAbilities()
{
    if (abilities_data == null || abilities_dirty)
        RebuildAbilitiesCache();
    return abilities_data;
}
```

### ç¤ºä¾‹ 3: é™æ€ç©ºåˆ—è¡¨
```csharp
// ä¼˜åŒ–å‰: é¢‘ç¹åˆ›å»ºç©ºåˆ—è¡¨äº§ç”Ÿ GC
public List<Card> GetCards()
{
    if (cards.Count == 0)
        return new List<Card>(); // GC åˆ†é…
    return cards;
}

// ä¼˜åŒ–å: å¤ç”¨é™æ€ç©ºåˆ—è¡¨
private static readonly List<Card> EmptyList = new List<Card>();
public List<Card> GetCards()
{
    if (cards.Count == 0)
        return EmptyList; // æ—  GC
    return cards;
}
```

## é£é™©ç­‰çº§

| ç­‰çº§ | æè¿° | æ“ä½œ |
|------|------|------|
| ğŸŸ¢ å®‰å…¨ | ä¸æ”¹å˜ä»£ç è¡Œä¸ºï¼Œä»…æ€§èƒ½æå‡ | å¯æ‰¹é‡åº”ç”¨ |
| ğŸŸ¡ è°¨æ… | è½»å¾®æ”¹å˜æ‰§è¡Œé¡ºåºæˆ–å¼‚å¸¸å¤„ç† | éœ€é€é¡¹ç¡®è®¤ |
| ğŸ”´ å±é™© | å¯èƒ½æ”¹å˜é€»è¾‘è¡Œä¸º | å¿…é¡»äººå·¥å®¡æŸ¥ |

## ç‰ˆæœ¬å†å²

- v1.0 (2026-02-10) - åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäº XiuXianCards Card.cs ä¼˜åŒ–ç»éªŒåˆ›å»º

---

*æœ¬ Skill éµå¾ª"å…ˆç¡®è®¤åæ‰§è¡Œ"åŸåˆ™ï¼Œå°Šé‡ç”¨æˆ·å¯¹ä»£ç çš„æ§åˆ¶æƒã€‚*
